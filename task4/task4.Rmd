---
title: "Методы статистической обработки информации. Задание 4"
author: "Ершов А. С., гр. 22.М04-мм"
output:
  pdf_document:
    latex_engine: xelatex
    includes:
      in_header: "preamble.tex"
  html_document:
    df_print: paged
  html_notebook: default
---

**Вариант 14.** Зависимая переменная: `thirst.1`.

## Задание

Данные `data_big.csv` о финских алкоголиках, переменные -- признаки в первый день отказа от запоя. Зависимая переменная - thirst.1, остальные переменные рассматриваются как независимые. Независимые категориальные переменные упорядочить по значимости влияния на зависимую переменную. Привести соответствующие частоты, значимости критерия хи-квадрат и точного критерия Фишера. По совместному распределению первых двух наиболее значимых переменных вычислить односторонний коэффициент неопределённости относительно зависимой переменной.

---

Функции, которые понадобятся для вычислений.

Вычисление энтропии.
```{r}
Entropy <- function(x, print=TRUE)
{
  p <- x / sum(x)
  p <- p[p != 0]
  if (print == TRUE)
  {
    print(- sum(p * log(p, 2)))
  }
  else
  {
    - sum(p * log(p, 2))
  }
}
```

Вычисление коэффициентов неопределённости.
```{r}
Uncertain <- function(tab)
{
  Hxy <- Entropy(matrix(tab, ncol = 1), FALSE)
  Hx <- Entropy(rowSums(tab), FALSE)
  Hy <- Entropy(colSums(tab), FALSE)
  I <- Hx + Hy - Hxy
  
  print(c(I / Hx * 100, I / Hy * 100, 2 * I / (Hx + Hy) * 100))
}
```

Вычисление хи-квадрат:
```{r}
chi2P <- function(tab)
{
  r <- rowSums(tab)
  c <- colSums(tab)
  
  chi2. <-
    (sum(sum(sapply(seq(ncol(tab)), function(j)
      sapply(seq(nrow(tab)), function(i)
        tab[i, j] ^ 2 / r[i] / c[j])))) - 1) * sum(sum(tab))
  
  1 - pchisq(chi2., (nrow(tab) - 1) * (ncol(tab) - 1))
}
```

Функция вычисления необходимых статистик.
```{r}
compute_metrics <- function(X, Y, X_name, Y_name)
{
  tab <- table(X=X, Y=Y)
  print(tab)
  # Условные вероятности
  prob <- tab[, 2] / rowSums(tab)
  print("Условные вероятности:")
  print(prob)
  
  # Точный критерий Фишера
  p.F <- fisher.test(tab)$p.value
  print("Точный критерий Фишера:")
  print(p.F)
  
  # Точный критерий Пирсона
  p.P<-chi2P(tab)
  print("Точный критерий Пирсона:")
  print(p.P)
  
  # Энтропия X
  print(sprintf("Энтропия переменной '%s':", X_name), TRUE)
  Entropy(table(X))
  
  # Энтропия Y
  print(sprintf("Энтропия переменной '%s':", Y_name), TRUE)
  Entropy(table(Y))
  
  # Коэффициенты неопределённости
  print("Коэффициенты неопределённости:")
  Uncertain(tab)
}
```

## Расчет метрик для переменных

Прочитаем тестовые данные из файла:
```{r}
data_big <- read.csv("./data_big.csv")
data <- data_big[, c(3:20)]
```

Из тестовых данных получим значения зависимой переменной `thirst.1` (жажда).
```{r}
X <- ifelse(data[, "thirst.1"] < 2,1,2)
X
```
Для каждой пары независимой переменной и зависимой переменной `thirst.1` (жажда) будем вычислять метрики (условные вероятности, точный критерий Фишера, точный критерий Пирсона, энтропию каждой переменной и коэффициенты неопределённости) и анализировать полученные результаты.

**Депрессивное настроение и жажда**

Подсчитаем значимость влияния независимой переменной `depressed.mood.1` (депрессивное настроение) на зависимую переменную `thirst.1` (жажда).

```{r}
compute_metrics(X, ifelse(data[, "depressed.mood.1"] < 2, 1, 2), "жажда", "дерессивное настроение")
```
Итог по этой паре признаков:

- Условные вероятности: при отсутствии жажды депрессивное настроение наблюдается в 10% случаев, при её наличии - более чем в 28% случаев.
- Точный критерий Фишера: значение больше, чем 0.05, тогда различие в условных вероятностях можно объяснить случайностью.
- Коэффициенты неопределённости: для признака жажда неопределённость больше, чем для признака депрессивное настроение.

**Тревога и жажда**

Подсчитаем значимость влияния независимой переменной `anxiety.1` (тревога) на зависимую переменную `thirst.1` (жажда).

```{r}
compute_metrics(X, ifelse(data[, "anxiety.1"] < 2, 1, 2), "жажда", "дерессивное настроение")
```
Итог по этой паре признаков:

- Условные вероятности: при отсутствии жажды тревоги наблюдается в 5% случаев, при её наличии - в 21% случаев.
- Точный критерий Фишера: значение больше, чем 0.05, тогда различие в условных вероятностях можно объяснить случайностью.
- Коэффициенты неопределённости: для признака жажда неопределённость больше, чем для признака тревога.

**Раздражительность и жажда**

Подсчитаем значимость влияния независимой переменной `irritability.1` (раздражительность) на зависимую переменную `thirst.1` (жажда).

```{r}
compute_metrics(X, ifelse(data[, "irritability.1"] < 2, 1, 2), "жажда", "раздражительность")
```
Итог по этой паре признаков:

- Условные вероятности: при отсутствии жажды раздражительность не наблюдается, при её наличии наблюдается в 7% случаев.
- Точный критерий Фишера: значение больше, чем 0.05, тогда различие в условных вероятностях можно объяснить случайностью.
- Коэффициенты неопределённости: для признака жажда неопределённость больше, чем для признака раздражительность.

**Тяга к алкоголю и жажда**

Подсчитаем значимость влияния независимой переменной `craving.to.alcohol.1` (тяга к алкоголю) на зависимую переменную `thirst.1` (жажда).

```{r}
compute_metrics(X, ifelse(data[, "craving.to.alcohol.1"] < 2, 1, 2), "жажда", "тяга к алкоголю")
```
Итог по этой паре признаков:

- Условные вероятности: при отсутствии жажды тяга к алкоголю наблюдается в 5% случаев, при её наличии - более чем в 28% случаев.
- Точный критерий Фишера: значение больше, чем 0.05, тогда различие в условных вероятностях можно объяснить случайностью.
- Коэффициенты неопределённости: для признака жажда неопределённость больше, чем для признака тяга к алкоголю.

**Слабость и жажда**

Подсчитаем значимость влияния независимой переменной `weakness.1` (слабость) на зависимую переменную `thirst.1` (жажда).

```{r}
compute_metrics(X, ifelse(data[, "weakness.1"] < 2, 1, 2), "жажда", "слабость")
```
Итог по этой паре признаков:

- Условные вероятности: при отсутствии жажды слабость наблюдается в 45% случаев, при её наличии - в 50% случаев.
- Точный критерий Фишера: значение больше, чем 0.05, тогда различие в условных вероятностях можно объяснить случайностью.
- Коэффициенты неопределённости: для признака жажда неопределённость меньше, чем для признака слабость.

**Бессонница и жажда**

Подсчитаем значимость влияния независимой переменной `insomia.1` (бессонница) на зависимую переменную `thirst.1` (жажда).

```{r}
compute_metrics(X, ifelse(data[, "insomia.1"] < 2, 1, 2), "жажда", "бессонница")
```
Итог по этой паре признаков:

- Условные вероятности: при отсутствии жажды бессонница наблюдается в 40% случаев, при её наличии - в 64% случаев.
- Точный критерий Фишера: значение больше, чем 0.05, тогда различие в условных вероятностях можно объяснить случайностью.
- Коэффициенты неопределённости: для признака жажда неопределённость меньше, чем для признака бессонница.

**Головная боль и жажда**

Подсчитаем значимость влияния независимой переменной `headache.11` (головная боль) на зависимую переменную `thirst.1` (жажда).

```{r}
compute_metrics(X, ifelse(data[, "headache.1"] < 2, 1, 2), "жажда", "головная боль")
```
Итог по этой паре признаков:

- Условные вероятности: при отсутствии жажды головная боль не наблюдается, при её наличии - в 14% случаев.
- Точный критерий Фишера: значение больше, чем 0.05, тогда различие в условных вероятностях можно объяснить случайностью.
- Коэффициенты неопределённости: для признака жажда неопределённость больше, чем для признака головная боль.

**Дрожь и жажда**

Подсчитаем значимость влияния независимой переменной `tremor.1` (дрожь) на зависимую переменную `thirst.1` (жажда).

```{r}
compute_metrics(X, ifelse(data[, "tremor.1"] < 2, 1, 2), "жажда", "дрожь")
```
Итог по этой паре признаков:

- Условные вероятности: при отсутствии жажды дрожь наблюдается в 25% случаев, при её наличии - в 50% случаев.
- Точный критерий Фишера: значение больше, чем 0.05, тогда различие в условных вероятностях можно объяснить случайностью.
- Коэффициенты неопределённости: для признака жажда неопределённость больше, чем для признака дрожь.

**Потливость и жажда**

Подсчитаем значимость влияния независимой переменной `sweating.1` (потливость) на зависимую переменную `thirst.1` (жажда).

```{r}
compute_metrics(X, ifelse(data[, "sweating.1"] < 2, 1, 2), "жажда", "потливость")
```
Итог по этой паре признаков:

- Условные вероятности: при отсутствии жажды потливость наблюдается в 20% случаев, при её наличии - более чем в 35% случаев.
- Точный критерий Фишера: значение больше, чем 0.05, тогда различие в условных вероятностях можно объяснить случайностью.
- Коэффициенты неопределённости: для признака жажда неопределённость больше, чем для признака потливость.

**Временные галлюцинации и жажда**

Подсчитаем значимость влияния независимой переменной `transient.hallusinations.1` (временные галлюцинации) на зависимую переменную `thirst.1` (жажда).

```{r}
compute_metrics(X, ifelse(data[, "transient.hallusinations.1"] < 2, 1, 2), "жажда", "временные галлюцинации")
```
Итог по этой паре признаков:

- Условные вероятности: при отсутствии жажды временные галлюцинации не наблюдаются, при её наличии - в 7% случаев.
- Точный критерий Фишера: значение больше, чем 0.05, тогда различие в условных вероятностях можно объяснить случайностью.
- Коэффициенты неопределённости: для признака жажда неопределённость больше, чем для признака временные галлюцинации.

**Тошнота и жажда**

Подсчитаем значимость влияния независимой переменной `vomiting.1` (тошнота) на зависимую переменную `thirst.1` (жажда).

```{r}
compute_metrics(X, ifelse(data[, "vomiting.1"] < 2, 1, 2), "жажда", "тошнота")
```
Итог по этой паре признаков:

- Условные вероятности: при отсутствии жажды тошнота не наблюдается, при её наличии - в 7% случаев.
- Точный критерий Фишера: значение больше, чем 0.05, тогда различие в условных вероятностях можно объяснить случайностью.
- Коэффициенты неопределённости: для признака жажда неопределённость больше, чем для признака тошнота.

**Анорекcия и жажда**

Подсчитаем значимость влияния независимой переменной `anoreksia.1` (анорекcия) на зависимую переменную `thirst.1` (жажда).

```{r}
compute_metrics(X, ifelse(data[, "anoreksia.1"] < 2, 1, 2), "жажда", "анорекcия")
```
Итог по этой паре признаков:

- Условные вероятности: при отсутствии жажды анорекcия наблюдается в 25% случаев, при её наличии - в 57% случаев.
- Точный критерий Фишера: значение больше, чем 0.05, тогда различие в условных вероятностях можно объяснить случайностью.
- Коэффициенты неопределённости: для признака жажда неопределённость больше, чем для признака анорекcия.

**Боль в спине и жажда**

Подсчитаем значимость влияния независимой переменной `chest.pain.1` (боль в спине) на зависимую переменную `thirst.1` (жажда).

```{r}
compute_metrics(X, ifelse(data[, "chest.pain.1"] < 2, 1, 2), "жажда", "боль в спине")
```
Итог по этой паре признаков:

- Условные вероятности: при отсутствии жажды боль в спине наблюдается в 10% случаев, при её наличии - в 14% случаев.
- Точный критерий Фишера: значение больше, чем 0.05, тогда различие в условных вероятностях можно объяснить случайностью.
- Коэффициенты неопределённости: для признака жажда неопределённость больше, чем для признака боль в спине.

**Гиперемия и жажда**

Подсчитаем значимость влияния независимой переменной `hyperemia.1` (гиперемия) на зависимую переменную `thirst.1` (жажда).

```{r}
compute_metrics(X, ifelse(data[, "hyperemia.1"] < 2, 1, 2), "жажда", "гиперемия")
```
Итог по этой паре признаков:

- Условные вероятности: при отсутствии жажды гиперемия наблюдается в 25% случаев, при её наличии - более чем в 35% случаев.
- Точный критерий Фишера: значение больше, чем 0.05, тогда различие в условных вероятностях можно объяснить случайностью.
- Коэффициенты неопределённости: для признака жажда неопределённость больше, чем для признака гиперемия.

## Наиболее значимые переменные

По результатам вычислений двумя наиболее значимыми переменными оказались `craving.to.alcohol.1` (тяга к алкоголю) и `anoreksia.1` (анорексия).

Посчитаем односторонний коэффициент неопределённости по совместному распределению этих переменных относительно зависимой переменной `thirst.1` (жажда).

Получим необходимые данные из исходных.
```{r}
Y <- ifelse(data[, "craving.to.alcohol.1"] < 2, 1, 2) + ifelse(data[, "anoreksia.1"] < 2, 1, 2)
tab <- table(X=X, Y=Y)
tab
```

Посчитаем условные вероятности.
```{r}
prob <- tab[, 2] / rowSums(tab)
prob
```
Если жажды нет, то тяга к алкоголю и анорексия у 30% наблюдаемых. Если жажда есть, то тяга к алкоголю и анорексия у более 42% наблюдаемых.

Посчитаем точный критерий Фишера.
```{r}
p.F <- fisher.test(tab)$p.value
p.F
```

Вычисленное значение критерия Фишера меньше, чем значения критерия Фишера признаков тяга к алкоголю и анорексия по-отдельности.

Посчитаем точный критерий Пирсона и коэффициенты неопределённости.
```{r}
p.P<-chi2P(tab)
p.P
```

```{r}
Uncertain(tab)
```
Выводы:

- Прогнозирование X: если есть тяга к алкоголю и анорексия, то, скорее всего, есть и жажда Определяется 16% информации.

- Прогнозирование Y: если есть жажда, то, скорее всего, есть и тяга к алкоголю, и анорексия. Определяется 12% информации.